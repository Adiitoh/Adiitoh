<%- include("../partials/header") %>

<div class="d-flex">
    <%- include("../partials/lecturer-sidebar") %>
    
    <div class="main-content flex-grow-1">
        <div class="container-fluid py-4">
            <!-- Page Header -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h1 class="h3 mb-0">Edit Assessment: <%= assessment.title %></h1>
                    <p class="text-muted">Modify assessment details and questions</p>
                </div>
                <div class="btn-group">
                    <button type="submit" form="assessmentForm" class="btn btn-primary">
                        <i class="bi bi-save me-1"></i>Save Changes
                    </button>
                    <a href="/lecturer/assessments" class="btn btn-outline-secondary">
                        <i class="bi bi-x-circle me-1"></i>Cancel
                    </a>
                </div>
            </div>

            <!-- Assessment Form -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="bi bi-clipboard-check me-2"></i>Assessment Details
                    </h5>
                </div>
                <div class="card-body">
                    <form id="assessmentForm" data-assessment-id="<%= assessment.id %>">
                        <div class="row g-3">
                            <div class="col-md-8">
                                <label for="title" class="form-label">Assessment Title *</label>
                                <input type="text" class="form-control" id="title" name="title" value="<%= assessment.title %>" required>
                            </div>
                            <div class="col-md-4">
                                <label for="course" class="form-label">Course *</label>
                                <select class="form-select" id="course" name="course_id" required>
                                    <option value="">Select Course</option>
                                    <% if (typeof courses !== 'undefined' && courses.length > 0) { %>
                                        <% courses.forEach(course => { %>
                                            <option value="<%= course.id %>" <%= assessment.course_id === course.id ? 'selected' : '' %>><%= course.name %> (<%= course.code %>)</option>
                                        <% }); %>
                                    <% } %>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="type" class="form-label">Assessment Type *</label>
                                <select class="form-select" id="type" name="type" required>
                                    <option value="">Select Type</option>
                                    <option value="quiz" <%= assessment.type === 'quiz' ? 'selected' : '' %>>Quiz</option>
                                    <option value="exam" <%= assessment.type === 'exam' ? 'selected' : '' %>>Exam</option>
                                    <option value="assignment" <%= assessment.type === 'assignment' ? 'selected' : '' %>>Assignment</option>
                                    <option value="homework" <%= assessment.type === 'homework' ? 'selected' : '' %>>Homework</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="dueDate" class="form-label">Due Date *</label>
                                <input type="datetime-local" class="form-control" id="dueDate" name="due_date" value="<%= assessment.due_date_iso %>" required>
                            </div>
                            <div class="col-md-4">
                                <label for="duration" class="form-label">Duration (minutes)</label>
                                <input type="number" class="form-control" id="duration" name="duration" min="0" value="<%= assessment.duration %>">
                            </div>
                            <div class="col-12">
                                <label for="description" class="form-label">Description</label>
                                <textarea class="form-control" id="description" name="description" rows="3"><%= assessment.description %></textarea>
                            </div>
                            <div class="col-md-4">
                                <label for="status" class="form-label">Status *</label>
                                <select class="form-select" id="status" name="status" required>
                                    <option value="draft" <%= assessment.status === 'draft' ? 'selected' : '' %>>Draft</option>
                                    <option value="published" <%= assessment.status === 'published' ? 'selected' : '' %>>Published</option>
                                    <option value="closed" <%= assessment.status === 'closed' ? 'selected' : '' %>>Closed</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="maxAttempts" class="form-label">Max Attempts</label>
                                <input type="number" class="form-control" id="maxAttempts" name="max_attempts" min="1" value="<%= assessment.max_attempts %>">
                            </div>
                            <div class="col-md-4">
                                <label for="passScore" class="form-label">Passing Score (%)</label>
                                <input type="number" class="form-control" id="passScore" name="passing_score" min="0" max="100" value="<%= assessment.passing_score %>">
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Questions Section -->
            <div class="card border-0 shadow-sm">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="bi bi-question-circle me-2"></i>Questions
                    </h5>
                    <button type="button" class="btn btn-primary btn-sm" id="addQuestionBtn">
                        <i class="bi bi-plus me-1"></i>Add Question
                    </button>
                </div>
                <div class="card-body">
                    <div id="questionsContainer">
                        <!-- Questions will be dynamically added here by JavaScript -->
                        <% if (assessment.questions && assessment.questions.length > 0) { %>
                            <script id="questionsData" type="application/json">
                                <%= JSON.stringify(assessment.questions) %>
                            </script>
                        <% } %>
                    </div>
                    <div class="text-center mt-3 d-none" id="autoSaveIndicator">
                        <small class="text-muted"></small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Add any specific styles for this page here */
</style>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        LecturerModule.assessments.initAssessmentForm();
    });
</script>

<%- include("../partials/footer") %>

